
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ПодсветитьСтрокиНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	ПодсветитьСтрокиНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура ДиаграммаГанта(Команда)
	
	ПараметрыФормы = СформироватьДанныеВоВременномХранилище();
	ОткрытьФорму("Документ.ВКМ_ГрафикОтпусков.Форма.ФормаАнализГрафика", ПараметрыФормы);
	
КонецПроцедуры

&НаСервере
Процедура ПодсветитьСтрокиНаСервере()
	
	Для Каждого Строка Из Объект.ОтпускаСотрудников Цикл
		Строка.Подсветить = Ложь;	
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ВКМ_ГрафикОтпусковОтпускаСотрудников.Сотрудник КАК Сотрудник,
	|	СУММА(РАЗНОСТЬДАТ(ВКМ_ГрафикОтпусковОтпускаСотрудников.ДатаНачала, ДОБАВИТЬКДАТЕ(КОНЕЦПЕРИОДА(ВКМ_ГрафикОтпусковОтпускаСотрудников.ДатаОкончания, ДЕНЬ), ДЕНЬ, 1), ДЕНЬ)) КАК КоличествоДнейОтпуска
	|ИЗ
	|	Документ.ВКМ_ГрафикОтпусков.ОтпускаСотрудников КАК ВКМ_ГрафикОтпусковОтпускаСотрудников
	|ГДЕ
	|	ВКМ_ГрафикОтпусковОтпускаСотрудников.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	ВКМ_ГрафикОтпусковОтпускаСотрудников.Сотрудник";
	
	Запрос.УстановитьПараметр("Ссылка", Объект.Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		
		Для Каждого Строка Из Объект.ОтпускаСотрудников Цикл  
			
			Если Строка.Подсветить Тогда
				Продолжить;
			КонецЕсли;   
			
			Строка.Подсветить = Ложь;  
			
			Если Строка.Сотрудник = ВыборкаДетальныеЗаписи.Сотрудник Тогда 
				
				Если ВыборкаДетальныеЗаписи.КоличествоДнейОтпуска > 28 Тогда
					Строка.Подсветить = Истина;	
				КонецЕсли; 
				
			КонецЕсли; 
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Функция СформироватьДанныеВоВременномХранилище()
	
	МассивДанных = Новый Массив;
		
	Для Каждого Строка Из Объект.ОтпускаСотрудников Цикл
		
		ОтпускСотрудуника = Новый Структура;
		ОтпускСотрудуника.Вставить("Сотрудник", Строка.Сотрудник);
		ОтпускСотрудуника.Вставить("ДатаНачала", Строка.ДатаНачала);
		ОтпускСотрудуника.Вставить("ДатаОкончания", Строка.ДатаОкончания);
		
		МассивДанных.Добавить(ОтпускСотрудуника);	
		
	КонецЦикла;
	
	ЗначенияЗаполнения = Новый Структура;
	ЗначенияЗаполнения.Вставить("ДанныеВХ", ПоместитьВоВременноеХранилище(МассивДанных));
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("ЗначенияЗаполнения", ЗначенияЗаполнения); 
	
	Возврат ПараметрыФормы;
	
КонецФункции
